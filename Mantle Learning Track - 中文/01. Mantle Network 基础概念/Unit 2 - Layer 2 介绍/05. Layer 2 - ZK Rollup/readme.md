# Content/内容

### 目标

本节的目标是学习一种 Layer2 的实现方式，叫做 ZK Rollup。

### 问题

1. Alice 开始与客户们采取 Optimistic Rollup 的方式来进行交易，且存在挑战机制导致 Alice 不敢作假，因为作假会被惩罚。
2. 但是客户们里面有一个非常有钱的人，他之前追求 Alice 不成，于是恼羞成怒，决定疯狂攻击 Alice 的这个系统。于是他每天都去申请挑战 Alice 提交的交易，虽然 Alice 没有作假，他挑战不成功会遭到金钱上的惩罚，但是他很有钱根本就无所谓。每一次挑战都会耽误一些时间，主链长期处于争议解决期，Alice 客户们都不太敢在这里做交易了，因为动不动就争议，他们觉得提心吊胆的。
3.  另外一方面，Alice 的客户们每一次想从 Layer2 提出资金到主链的时候，都需要等待完整个的挑战期，一般为 7 天，他们觉得资金的流转效率不是很高。关于这一点，客户们跟 Alice 已经闹过好几次意见了。

### 解决方案

因为这些问题的存在，Alice 就去找 Bob 请教，Bob 告诉了她一种方法叫做 Zero-knowledge (ZK) Rollup。具体的方案如下：

- Alice 跟客户们说，以后我们不搞挑战期了，我们用数学的方式来证明我提交到主链的交易一定是正确且没有作假的。
- 但是其他客户们说，我们凭什么相信你呢？Alice 说，现在数学上面有一种方法，可以让我不用提交所有交易的细节，只需要提交一个 commitment，通过这个 commitment 你们就可以验证我绝对没有作假。
- 看到客户们还是一脸懵逼，Alice 打了个比方说，
    - 假设我是一个数学家，我知道一个公式，但是我不想透露这个公式，可是我想证明我知道这个公式。
    - 只要你给我一个输入，我绝对在有限的时间就能给你返回一个输出，你有能力验证这个输出是正确的，你问我一万次都正确的话，在数学概率上我基本 100% 是知道这个公式的，所以你可以相信我。
    - 这就是零知识证明的原理，不信你们可以去问 Bob 或者去问学术界的学者们。
- 客户们找到了一些教授，发现这个东西还真的存在，于是他们同意了，说那我们开始用这个方式吧。
- Alice 和客户们花了一些钱将这个方案外包了出去，一个月后他们开始开心地用起来新的系统 ZK Rollup，且每一次提交交易都不需要挑战了，因为从数学上证明了这玩意是绝对无法造假的。

如此一来，Alice 的问题解决了，她非常开心，打算继续使用这个方案。

### **小结**

这一小节我们学习了 ZK Rollup 这种方案，它的技术原理如下：

1. 构建侧链：首先，创建一个独立的侧链，通常基于以太坊虚拟机（EVM）的兼容链。这个侧链可以是一个独立的区块链，也可以是一个分区（rollup）。
2. 执行和批量提交：在侧链上执行智能合约的交易，并将这些交易按照一定的规则进行批量提交。每个批次通常包含多个交易。
3. 状态转移和合并：在每个批次提交时，侧链上的状态转移被记录，并与之前的状态进行合并。这样，侧链的状态会逐步更新和累积，反映所有已提交的批次的状态转移。
4. 零知识证明：在每个批次提交时，为了确保侧链上的状态转移的正确性和可验证性，使用零知识证明来证明每个批次的交易执行是正确的，而无需公开详细的交易内容。这样可以保护交易的隐私。
5. 主链提交：定期（通常是每个批次或一定的时间间隔）将侧链上的状态根哈希和相应的零知识证明提交到以太坊主链上。这个提交信息作为一个摘要，证明了侧链上的状态转移是有效的，并且可以在主链上进行验证。
6. 主链验证：在以太坊主链上，验证人（validators）可以验证提交的状态根哈希和零知识证明，以确保侧链上的状态转移是正确的。验证人可以根据需要进行验证，并有机会参与主链上的共识机制。

它解决了 Optimistic Rollup 持续被挑战带来的持续争议问题，以及为了保证安全导致的挑战期过长问题。

### 下一节

刚才提到 ZK Rollup 可以解决的一些问题。
但是 ZK Rollup 本身是否有什么缺点呢？同学们可以思考一下。
下一小节我们会讨论 ZK Rollup 的缺点，并且开始进入到 Mantle 公链的学习当中。

# Learn More

ZK Rollup 的起源可以追溯到以色列公司 StarkWare，该公司由以色列工程师 Eli Ben-Sasson 和 Alessandro Chiesa 等人于 2018 年创建。ZK Rollup 使用零知识证明（Zero-Knowledge Proofs）来证明交易的有效性，同时不揭示具体的交易信息。这种方法强调隐私和安全性，并且不依赖于主链的验证。

代表项目：

- [zkSync](https://zksync.io/)
- [ZKSpace](https://zks.org/)